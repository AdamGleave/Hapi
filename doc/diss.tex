\documentclass[12pt,a4paper,twoside,notitlepage]{report}

% Allow large number of packages to be used. Workaround LaTeX limitation.
\usepackage{etex}
\reserveinserts{28}

% Explictly specify character encoding
\usepackage[ascii]{inputenc}

% Change font to Palatino
\usepackage[sc]{mathpazo}
\linespread{1.05}         % apparently Palatino needs more leading space between lines
\usepackage[T1]{fontenc}

% Page formatting
\usepackage[parfill]{parskip} 
\usepackage[margin=1in]{geometry}

% Internationalization: customize to UK English style
\usepackage{csquotes}
\usepackage[UKenglish]{babel}

% Make list environments more configurable
\usepackage{enumitem}

% Hyperlinks
% Note must load url before hyperref
\usepackage[hyphens]{url}

% Citations
\usepackage{varioref}
\usepackage{nameref}
% TODO: What citation style should I use?
\usepackage[backend=biber,bibencoding=UTF-8,style=numeric]{biblatex}
\bibliography{diss.bib}
\DeclareBibliographyCategory{cited}
\AtEveryCitekey{\addtocategory{cited}{\thefield{entrykey}}}
\usepackage{footnote}

% Indexing
\usepackage[bookmarks,pdftex]{hyperref}
\usepackage{makeidx}

% Hyperref setup
% Colour of links, and bio information
\hypersetup{
	colorlinks,
	linkcolor={red!50!black},
	citecolor={blue!50!black},
	urlcolor={blue!80!black},
	pdfauthor = {Adam Gleave},
	pdftitle = {Flow network scheduling}
}

\makeindex

% Figures
\usepackage{verbatim} % environment where formatting preserved exactly
\usepackage{tikz} % language for figures
\usepackage{booktabs}
\usepackage{subcaption} 
\usepackage{xcolor}
\usepackage[export]{adjustbox}
\usepackage{graphicx}
\usepackage[justification=centering,font=it]{caption}
\usepackage{colortbl}
\usepackage{tabularx}

\graphicspath{figures/}
\DeclareGraphicsExtensions{.pdf, .png, .jpg}

% Pseudocode and code listings
\usepackage[section]{algorithm} % floating environment
\usepackage{algpseudocode} % algorithmicx package
\usepackage{listings}
% default listings package configuration for highlighting C code
\lstset{
	language = C,
	basicstyle=\ttfamily,
	keywordstyle=\color[rgb]{0,0,1}\ttfamily\bfseries,
	identifierstyle=\ttfamily,
	stringstyle=\color[rgb]{0.627,0.126,0.941}\ttfamily,
	commentstyle=\color[rgb]{0.133,0.545,0.133}\ttfamily,
	morecomment=[l][\color{magenta}]{\#},
	captionpos=b,
}

% Mathematics
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{cleveref}
\theoremstyle{plain}
% Define theorem to be numbered by section
% Make lemma and corollary share same counter
\newtheorem{thm}{Theorem}[section]
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{cor}[thm]{Corollary}
% Define style for definitions, remarks
\theoremstyle{definition}
\newtheorem{defn}{Definition}[section]
\newtheorem{assumption}{Assumption}[section]
\theoremstyle{remark}
\newtheorem{remark}{Remark}[section]
% Tell cleveref what the plural forms are
\crefname{thm}{theorem}{theorems}
\crefname{lemma}{lemma}{lemmas}
\crefname{corollary}{corollary}{corollaries}
\crefname{defn}{definition}{definitions}
\crefname{assumption}{assumption}{assumptions}
\crefname{remark}{remark}{remarks}

% Customize Table of Contents. Don't include list of figures or table of contents in the table of contents. Do still show the bibliography.
\usepackage[nottoc,notlof]{tocbibind}

% Proofreading
\usepackage{showidx}
\usepackage{todonotes}

% Miscellaneous formatting
\raggedbottom					% try to avoid widows and orphans
\sloppy
\clubpenalty 1000
\widowpenalty 1000
\hyphenpenalty 10000

% tick and cross marks
% per http://tex.stackexchange.com/questions/42619/x-mark-to-match-checkmark
\usepackage{pifont}
\newcommand{\cmark}{{\color{green} \ding{51}}}
\newcommand{\xmark}{{\color{red} \ding{55}}}

\makeatletter
\pgfdeclareshape{document}{
	\inheritsavedanchors[from=rectangle] % this is nearly a rectangle
	\inheritanchorborder[from=rectangle]
	\inheritanchor[from=rectangle]{center}
	\inheritanchor[from=rectangle]{north}
	\inheritanchor[from=rectangle]{south}
	\inheritanchor[from=rectangle]{west}
	\inheritanchor[from=rectangle]{east}
	\inheritanchor[from=rectangle]{north east}
	\inheritanchor[from=rectangle]{north west}
	% ... and possibly more
	\backgroundpath{% this is new
	% store lower right in xa/ya and upper right in xb/yb
	\southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
	\northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
	% compute corner of ‘‘flipped page’’
	\pgf@xc=\pgf@xb \advance\pgf@xc by-10pt % this should be a parameter
	\pgf@yc=\pgf@yb \advance\pgf@yc by-10pt
	% construct main path
	\pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
	\pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
	\pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yb}}
	\pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yc}}
	\pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@ya}}
	\pgfpathclose
	% add little corner
	\pgfpathmoveto{\pgfpoint{\pgf@xc}{\pgf@yb}}
	\pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
	\pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yc}}
	\pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
	}
}
\makeatother

% Add new section level, subsubsubsection, in between subsubsection and paragraph
\usepackage{titlesec}

\titleclass{\subsubsubsection}{straight}[\subsection]

\newcounter{subsubsubsection}[subsubsection]
\renewcommand\thesubsubsubsection{\thesubsubsection.\arabic{subsubsubsection}}
\renewcommand\theparagraph{\thesubsubsubsection.\arabic{paragraph}} % optional; useful if paragraphs are to be numbered

\titleformat{\subsubsubsection}
{\normalfont\normalsize\bfseries}{\thesubsubsubsection}{1em}{}
\titlespacing*{\subsubsubsection}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{5}{\z@}%
	{3.25ex \@plus1ex \@minus.2ex}%
	{-1em}%
	{\normalfont\normalsize\bfseries}}
\renewcommand\subparagraph{\@startsection{subparagraph}{6}{\parindent}%
	{3.25ex \@plus1ex \@minus .2ex}%
	{-1em}%
	{\normalfont\normalsize\bfseries}}
\def\toclevel@subsubsubsection{4}
\def\toclevel@paragraph{5}
\def\toclevel@paragraph{6}

\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}

% Control indentation in TOC
\def\l@subsubsubsection{\@dottedtocline{4}{11em}{5em}}
\def\l@paragraph{\@dottedtocline{5}{14em}{6em}}
\def\l@subparagraph{\@dottedtocline{6}{18em}{7em}}
\makeatother

% Make nameref work with titlesec
\makeatletter
\def\ttl@useclass#1#2{%
	\@ifstar
	{\ttl@labeltrue\@dblarg{#1{#2}}}% {\ttl@labelfalse#1{#2}[]}%
	{\ttl@labeltrue\@dblarg{#1{#2}}}}
\makeatother

\begin{document}

\nocite{*}                      % detect unused references
%\bibliographystyle{acm}		% used ieeetr in the proposal
								% what is the style guide consensus?

%TC:ignore
%%
\pagestyle{empty}

\hfill{\large \bf Adam Gleave}

\vspace*{30mm}

\begin{center}
	% TODO: Name for project; logo; snappy title
	{\LARGE \textbf{Cluster scheduling using flow networks}} \\
    \large
	\vspace*{5mm}
	Computer Science Tripos, Part II \\
	\vspace*{5mm}
	St John's College \\
	\vspace*{5mm}
	\today
\end{center}
\clearpage
\vspace*{\fill}

TODO: Back of cover sheet

\vspace*{\fill}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Proforma

\setcounter{page}{1}
\pagenumbering{roman}
\pagestyle{plain}
\chapter*{Proforma}
\vspace*{-2em}
{
	\begin{tabular}{ll}
		Name:			& \textbf{Adam Gleave}					\\
		College:		& \textbf{St John's College}\\
    Project Title:	& \textbf{Cluster scheduling using flow networks}\\
		Examination:	& \textbf{Computer Science Tripos, Part II (June 2015)}\\
    Word Count:		& \textbf{\input{diss-auto-wordcount} \unskip}\\
		Project Originators:	& \textbf{Ionel Gog}\\
    Supervisors:	& \textbf{Ionel Gog \& Malte Schwarzkopf}\\
	\end{tabular}
}

% move this here so the table above doesn't get extra space added (which I don't want)
\renewcommand{\arraystretch}{1.3}
\vspace*{-1em}
\section*{Original aims of the project}

TODO

\vspace*{-1em}
\section*{Work completed}

TODO

\vspace*{-1em}
\section*{Special difficulties}

TODO

\newpage

\section*{Declaration}

I, Adam Gleave of St John's College, being a candidate for Part II of the 
Computer Science Tripos, hereby declare that this dissertation and the work 
described in it are my own work, unaided except as may be specified below, and
that the dissertation does not contain material that has already been used to
any substantial extent for a comparable purpose.

\bigskip
\leftline{Signed}
\medskip
\leftline{Date: \today}

\clearpage

\tableofcontents

% Calling it list of algorithms or similar could be more appropriate?
\listoffigures

\newpage
\section*{Acknowledgements}

TODO

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Chapters
\clearpage	% before we change the page numbering

%TC:endignore
\setcounter{page}{1}
\pagenumbering{arabic}
\pagestyle{headings}

\include{diss-intro}

\cleardoublepage
\include{diss-prep}

\cleardoublepage
\include{diss-impl}

\cleardoublepage
\include{diss-eval}

\cleardoublepage
\include{diss-conc}

\cleardoublepage

% Bib and Appendices etc
\printbibliography[heading=bibintoc,category=cited]

% PROOFREAD
\printbibliography[title={WARNING: Uncited},notcategory=cited]

% PROOFREAD
% % Index
% \cleardoublepage
% %\addcontentsline{toc}{chapter}{Index}
% \printindex

%TC:ignore
\appendix
\chapter{Appendices}

\section{Test specification}
State specifications of test machine/cluster.
\clearpage

% Note project proposal must appear at very end of dissertation, so do not move this!
\clearpage
\section{Project proposal} \label{sec:proposal}
\input{propbody}
%TC:endignore

\end{document}
